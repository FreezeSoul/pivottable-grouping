<!DOCTYPE HTML>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <!-- PivotTable.js libs from ../dist -->
        <link rel="stylesheet" type="text/css" href="dist/pivot.css">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="dist/pivot.js"></script>
        <!-- <script type="text/javascript" src="../p2/dist/pivot.js"></script> -->

        <title>Kuba test</title>
    </head>
    <body>
        <div></div>

        <script>
            const fixtureData = [
                ["name", "gender", "colour", "birthday", "trials", "successes"],
                ["Nick", "male", "blue", "1982-11-07", 103, 12],
                ["Jane", "female", "red", "1982-11-08", 95, 25],
                ["John", "male", "blue", "1982-12-08", 112, 30],
                ["Carol", "female", "yellow", "1983-12-08", 102, 14]
            ];

            const raggedFixtureData = [
                { name: "Nick", colour: "red", age: 34 },
                { name: "Jane", gender: "female" },
                { name: "John", gender: "male", age: 12 },
                { name: "Jim",  gender: null, age: 12 },
            ];
            const { sortAs, derivers, aggregators } = $.pivotUtilities;
            // table = $("div").pivot(data, {
            //     rows: ["gender"], 
            //     // cols: ["colour"],
            //     aggregator: aggregators["Sum as Fraction of Total"](["trials"])
            // });

            // table = $("div").pivotUI(raggedFixtureData, {
            //     rows: ["gender"],
            //     cols: ["age"]
            // });

            // Ten jest ok tylko wstawia subtotale  -> jasmin:335
            var getVal, tpl, aggregator;
            getVal = function (aggregator) {
                var pd;
                pd = new $.pivotUtilities.PivotData(fixtureData, {
                    aggregator: aggregator
                });
                return pd.getAggregator([], []).value();
            };
            tpl = $.pivotUtilities.aggregatorTemplates;
            aggregator = tpl.listUnique()(['gender']);

            table = $("div").pivot(fixtureData, {
                rows: ["name", "colour"],
                cols: ["trials", "successes"],
                aggregator: aggregator
            });
            console.log('fm', pivotData.getAggregator([],[]).value());

            // it("has correctly-ordered row keys", function () {
            //     return expect(pd.getRowKeys()).toEqual([['Carol', 'yellow'], ['Jane', 'red'], ['John', 'blue'], ['Nick', 'blue']]);
            // });
            // it("has correctly-ordered col keys", function () {
            //     return expect(pd.getColKeys()).toEqual([[95, 25], [102, 14], [103, 12], [112, 30]]);
            // });            
            // it("can be iterated over", function () {
            var c, i, j, len, len1, numNotNull, numNull, r, ref, ref1, pd;
            pd = window.pivotData;
            numNotNull = 0;
            numNull = 0;
            for(r of pd.getRowKeys())
                if(r.length == pd.rowAttrs.length)
                for (c of pd.getColKeys())
                    if(c.length == pd.colAttrs.length)
                    if(pd.getAggregator(r,c).value() != null){
                        numNotNull++;
                    } else {
                        numNull++;
                    }
            console.log(numNotNull, " toBe ", 4);
            console.log(numNull, " toBe ", 12);

        </script>
        
    </body>
</html>
